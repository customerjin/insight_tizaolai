<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å®è§‚æµåŠ¨æ€§ä»ªè¡¨ç›˜</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;background:#0f172a;color:#e2e8f0;line-height:1.6;font-size:14px}
.container{max-width:1200px;margin:0 auto;padding:20px}

/* Loading */
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:80vh;gap:16px}
.loading-spinner{width:48px;height:48px;border:4px solid #334155;border-top-color:#3b82f6;border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{color:#94a3b8;font-size:14px}

/* Header */
.header{display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-bottom:1px solid #1e293b;margin-bottom:24px;flex-wrap:wrap;gap:12px}
.header h1{font-size:22px;font-weight:800;color:#f1f5f9;letter-spacing:-0.5px}
.header-meta{font-size:12px;color:#64748b}
.header-badge{display:inline-block;padding:2px 10px;background:#1e293b;border-radius:6px;font-size:11px;color:#94a3b8;margin-left:8px}

/* Score Hero */
.score-hero{background:linear-gradient(135deg,#1e293b 0%,#0f172a 50%,#1e293b 100%);border:1px solid #334155;border-radius:20px;padding:32px;margin-bottom:24px;display:flex;gap:32px;flex-wrap:wrap}
.score-left{flex:0 0 240px;text-align:center;display:flex;flex-direction:column;align-items:center}
.score-label{font-size:11px;text-transform:uppercase;letter-spacing:2px;color:#64748b;margin-bottom:8px}
.score-number{font-size:80px;font-weight:900;line-height:1;letter-spacing:-4px;font-variant-numeric:tabular-nums}
.score-tier{display:inline-block;padding:6px 20px;border-radius:12px;font-size:16px;font-weight:800;margin-top:10px}
.score-right{flex:1;min-width:300px}
.advice-position{font-size:22px;font-weight:800;margin-bottom:8px}
.advice-detail{font-size:14px;line-height:1.8;color:#94a3b8;margin-bottom:16px}
.advice-action{font-size:13px;padding:8px 14px;background:rgba(255,255,255,0.04);border-radius:8px;border-left:3px solid #3b82f6;color:#cbd5e1;margin-bottom:6px}
.advice-risk{font-size:12px;color:#fca5a5;padding:6px 12px;background:rgba(239,68,68,0.08);border-radius:6px;margin-top:10px}
.advice-catalyst{font-size:12px;color:#86efac;padding:6px 12px;background:rgba(34,197,94,0.08);border-radius:6px;margin-top:6px}

/* Asset cards */
.asset-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-bottom:24px}
.asset-card{background:#1e293b;border:1px solid #334155;border-radius:14px;padding:20px;display:flex;align-items:center;gap:16px}
.asset-icon{font-size:36px;width:52px;height:52px;display:flex;align-items:center;justify-content:center;background:#0f172a;border-radius:12px}
.asset-info{flex:1}
.asset-name{font-size:13px;color:#94a3b8;font-weight:600}
.asset-score-num{font-size:28px;font-weight:900;font-variant-numeric:tabular-nums}
.asset-tier-badge{display:inline-block;padding:2px 10px;border-radius:6px;font-size:11px;font-weight:700;margin-top:2px}
.asset-note{font-size:10px;color:#64748b;margin-top:4px;line-height:1.4}

/* Score bars */
.breakdown{background:#1e293b;border:1px solid #334155;border-radius:14px;padding:24px;margin-bottom:24px}
.breakdown-title{font-size:16px;font-weight:700;margin-bottom:4px}
.breakdown-sub{font-size:11px;color:#64748b;margin-bottom:16px}
.bar-row{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.bar-label{width:110px;font-size:12px;font-weight:600;color:#94a3b8;text-align:right;flex-shrink:0}
.bar-weight{font-size:10px;color:#475569;margin-left:4px}
.bar-track{flex:1;height:22px;background:#0f172a;border-radius:11px;overflow:hidden;position:relative}
.bar-fill{height:100%;border-radius:11px;transition:width 1s ease-out}
.bar-val{width:36px;font-size:14px;font-weight:800;text-align:right;font-variant-numeric:tabular-nums}
.bar-signal{width:32px;font-size:11px;font-weight:700;text-align:center}

/* Factors */
.factors{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:18px;padding-top:18px;border-top:1px solid #334155}
.factors-title{font-size:12px;font-weight:700;margin-bottom:6px}
.factor-item{font-size:12px;padding:3px 0;color:#cbd5e1}

/* Section divider */
.section-divider{font-size:18px;font-weight:800;color:#f1f5f9;margin:32px 0 16px;padding-bottom:8px;border-bottom:2px solid #334155;letter-spacing:-0.3px}

/* Judgment */
.judgment{background:#1e293b;border:1px solid #334155;border-radius:14px;padding:20px 24px;margin-bottom:24px}
.judgment-regime{display:inline-block;padding:6px 16px;border-radius:10px;font-size:16px;font-weight:800;margin-bottom:10px}
.judgment-text{font-size:14px;line-height:1.7;color:#cbd5e1}
.judgment-tags{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.judgment-tag{padding:3px 10px;background:#0f172a;border-radius:6px;font-size:11px;color:#94a3b8}

/* Summary table */
.table-wrap{background:#1e293b;border:1px solid #334155;border-radius:14px;overflow:hidden;margin-bottom:24px}
table{width:100%;border-collapse:collapse;font-size:12px}
th{background:#0f172a;padding:10px 12px;text-align:left;font-weight:600;font-size:10px;text-transform:uppercase;letter-spacing:0.8px;color:#64748b;border-bottom:2px solid #334155}
td{padding:9px 12px;border-bottom:1px solid #1e293b}
tr:hover{background:rgba(255,255,255,0.02)}
.num{text-align:right;font-variant-numeric:tabular-nums;font-family:"SF Mono",Monaco,"Fira Code",monospace}
.signal-badge{display:inline-block;padding:2px 8px;border-radius:8px;font-size:10px;font-weight:700}

/* Indicator sections */
.indicator{background:#1e293b;border:1px solid #334155;border-radius:14px;padding:24px;margin-bottom:20px}
.indicator-header{display:flex;align-items:center;gap:14px;margin-bottom:16px}
.indicator-num{width:32px;height:32px;border-radius:50%;background:#3b82f6;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px;flex-shrink:0}
.indicator-title{font-size:16px;font-weight:700}
.indicator-val{font-size:12px;color:#64748b;margin-top:2px}
.indicator-chart{margin-bottom:16px;border-radius:8px;overflow:hidden}
.indicator-chart img{width:100%;display:block}
.explain-what{margin-bottom:12px}
.explain-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.8px;color:#64748b;margin-bottom:4px}
.explain-text{font-size:13px;line-height:1.7;color:#94a3b8}
.explain-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
.explain-good{padding:12px;background:rgba(16,185,129,0.06);border-left:3px solid #10b981;border-radius:0 8px 8px 0}
.explain-bad{padding:12px;background:rgba(239,68,68,0.06);border-left:3px solid #ef4444;border-radius:0 8px 8px 0}
.interpret-box{background:rgba(59,130,246,0.06);border:1px solid rgba(59,130,246,0.2);border-radius:10px;padding:14px 16px}
.interpret-box .explain-text{color:#93c5fd}

/* Quality */
.quality{background:#1e293b;border:1px solid #334155;border-radius:14px;padding:20px 24px;margin-bottom:24px}

/* Quick nav */
.nav-bar{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:24px}
.nav-link{display:inline-block;padding:5px 14px;background:#1e293b;border:1px solid #334155;border-radius:8px;font-size:11px;color:#94a3b8;text-decoration:none;cursor:pointer;transition:all .15s}
.nav-link:hover{background:#334155;color:#f1f5f9}

/* Footer */
.footer{text-align:center;padding:24px 0;font-size:11px;color:#475569;border-top:1px solid #1e293b;margin-top:32px}

/* Note */
.note{font-size:11px;color:#475569;padding:8px 12px;background:#0f172a;border-radius:6px;margin-top:8px;line-height:1.6}

/* Responsive */
@media(max-width:768px){
  .score-hero{padding:20px}
  .score-left{flex:0 0 auto;width:100%}
  .score-number{font-size:64px}
  .explain-grid{grid-template-columns:1fr}
  .factors{grid-template-columns:1fr}
  .bar-label{width:80px;font-size:11px}
}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useMemo } = React;

// ============================================================
// Indicator knowledge (static, same as Python version)
// ============================================================
const KNOWLEDGE = {
  net_liquidity: {
    title: "å‡€æµåŠ¨æ€§ (Net Liquidity)",
    what: "è¡¡é‡ç¾è”å‚¨å®é™…å‘é‡‘èä½“ç³»é‡Šæ”¾äº†å¤šå°‘å¯ç”¨æµåŠ¨æ€§ã€‚å…¬å¼ï¼šFedæ€»èµ„äº§ - TGA - ON RRPã€‚è¿™æ˜¯æ•´ä¸ªæ¡†æ¶çš„æ ¸å¿ƒé”šã€‚",
    high: "é‡‘èä½“ç³»æ°´ä½å……è£•ï¼Œé“¶è¡Œé—´èµ„é‡‘å®½æ¾ï¼Œé£é™©èµ„äº§å€¾å‘è·å¾—æ”¯æ’‘ã€‚",
    low: "ç³»ç»Ÿæ€§æµåŠ¨æ€§æ”¶ç´§ï¼Œé“¶è¡Œå‡†å¤‡é‡‘ä¸‹é™ï¼Œèµ„é‡‘æˆæœ¬ä¸Šå‡å‹åŠ›å¢å¤§ã€‚",
    chart: "net_liquidity",
  },
  composite: {
    title: "å‡€æµåŠ¨æ€§ vs S&P 500",
    what: "å°†å‡€æµåŠ¨æ€§ä¸æ ‡æ™®500å åŠ å¯¹æ¯”ï¼ŒéªŒè¯'æµåŠ¨æ€§é©±åŠ¨é£é™©åå¥½'çš„æ ¸å¿ƒé€»è¾‘ã€‚ä¸¤è€…èƒŒç¦»æ—¶éœ€è­¦æƒ•ã€‚",
    high: "ä¸¤è€…åŒæ­¥ä¸Šè¡Œ = æµåŠ¨æ€§é©±åŠ¨çš„å¥åº·ç‰›å¸‚ã€‚",
    low: "ä¸¤è€…èƒŒç¦» = æµåŠ¨æ€§åŸºç¡€æ¾åŠ¨ï¼Œé£é™©èµ„äº§å¯èƒ½æ»åååº”ã€‚",
    chart: "composite_netliq_spx",
  },
  sofr: {
    title: "SOFR (æ‹…ä¿éš”å¤œèèµ„åˆ©ç‡)",
    what: "ç¾å›½çŸ­æœŸèµ„é‡‘å¸‚åœºåŸºå‡†åˆ©ç‡ã€‚ç´§è´´è”é‚¦åŸºé‡‘åˆ©ç‡åŒºé—´è¿è¡Œï¼Œæ˜¾è‘—åé«˜è¯´æ˜çŸ­æœŸèèµ„å¸‚åœºç´§å¼ ã€‚",
    high: "èèµ„æˆæœ¬ä¸Šå‡ï¼Œå¯èƒ½åæ˜ å‡†å¤‡é‡‘ä¸è¶³ã€‚å¯¹æ æ†ç­–ç•¥ä¸åˆ©ã€‚",
    low: "èµ„é‡‘é¢å®½æ¾ï¼Œå€Ÿè´·æˆæœ¬ä½ï¼Œæœ‰åˆ©äºæ æ†ç­–ç•¥ã€‚",
    chart: "sofr",
  },
  move_proxy: {
    title: "åˆ©ç‡æ³¢åŠ¨ä»£ç† (MOVE Proxy)",
    what: "ç”¨VIX Ã— å›½å€ºåˆ©ç‡æ³¢åŠ¨ç‡æ„å»ºã€‚åæ˜ å€ºåˆ¸å¸‚åœºéšå«æ³¢åŠ¨é¢„æœŸï¼Œåˆ©ç‡æ³¢åŠ¨ç‡å‡é«˜é€šå¸¸å…ˆäºè‚¡å¸‚æ³¢åŠ¨ã€‚",
    high: "å€ºå¸‚ææ…ŒåŠ å‰§ï¼Œæ æ†åŸºé‡‘è¢«è¿«å»æ æ†ï¼Œå¯èƒ½ä¼ å¯¼è‡³é£é™©èµ„äº§ã€‚",
    low: "åˆ©ç‡å¸‚åœºå¹³é™ï¼Œæœ‰åˆ©äºcarryå’Œdurationç­–ç•¥ã€‚",
    chart: "move_proxy",
  },
  hy_oas: {
    title: "é«˜æ”¶ç›Šä¿¡ç”¨åˆ©å·® (HY OAS)",
    what: "é«˜æ”¶ç›Šå€ºç›¸å¯¹å›½å€ºçš„ä»·å·®ã€‚ä¿¡ç”¨å¸‚åœºçš„'ææ…ŒæŒ‡æ ‡'ã€‚>500bpså‹åŠ›åŒºï¼Œ>800bpså±æœºåŒºã€‚",
    high: "ä¿¡ç”¨å¸‚åœºå®šä»·è¿çº¦é£é™©ä¸Šå‡ï¼Œé¢†å…ˆäºç»æµè¡°é€€3-6ä¸ªæœˆã€‚",
    low: "ä¿¡ç”¨å¸‚åœºä¹è§‚ï¼Œä¼ä¸šèèµ„ç¯å¢ƒå‹å¥½ã€‚",
    chart: "hy_oas",
  },
  usdjpy: {
    title: "USD/JPY (ç¾å…ƒå…‘æ—¥å…ƒ)",
    what: "å…¨çƒå¥—æ¯äº¤æ˜“é£å‘æ ‡ã€‚æŠ•èµ„è€…å€Ÿå…¥ä½æ¯æ—¥å…ƒã€æŠ•èµ„é«˜æ¯ç¾å…ƒèµ„äº§ã€‚èµ°åŠ¿åæ˜ å¥—æ¯äº¤æ˜“æ‹¥æŒ¤ç¨‹åº¦å’Œå¹³ä»“é£é™©ã€‚",
    high: "æ—¥å…ƒå¼±ã€å¥—æ¯ç›ˆåˆ©æ‰©å¤§ã€Risk-Onã€‚ä½†æç«¯é«˜ä½å¯èƒ½è§¦å‘BOJå¹²é¢„ã€‚",
    low: "æ—¥å…ƒèµ°å¼ºã€å¥—æ¯å¹³ä»“ã€å…¨çƒå»æ æ†å‹åŠ›ä¸Šå‡ã€‚å¿«é€Ÿä¸‹è·Œæ˜¯æœ€å±é™©çš„å®è§‚ä¿¡å·ä¹‹ä¸€ã€‚",
    chart: "usdjpy",
  },
  carry_spread: {
    title: "å¥—æ¯åˆ©å·® (US 2Y - JP 2Y)",
    what: "ç¾å›½vsæ—¥æœ¬2å¹´æœŸå›½å€ºåˆ©å·®ï¼Œè¡¡é‡å¥—æ¯äº¤æ˜“çš„åˆ©å·®åŸºç¡€ã€‚åˆ©å·®è¶Šå¤§â†’å¥—æ¯æ”¶å…¥è¶Šä¸°åšâ†’å¸å¼•æ›´å¤šèµ„é‡‘ã€‚",
    high: "å¥—æ¯æœ‰å¼ºåˆ©å·®æ”¯æ’‘ï¼Œå…¨çƒèµ„é‡‘å€¾å‘æµå…¥ç¾å…ƒèµ„äº§ã€‚",
    low: "å¥—æ¯åŠ¨åŠ›è¡°å‡ï¼Œå¿«é€Ÿæ”¶çª„ä¼šè§¦å‘å¤§è§„æ¨¡å¹³ä»“ã€‚",
    chart: "carry_spread_bps",
  },
  curve_slope: {
    title: "æ”¶ç›Šç‡æ›²çº¿æ–œç‡ (10Y - 2Y)",
    what: "æœ€ç»å…¸çš„ç»æµå‘¨æœŸå‰ç»æŒ‡æ ‡ã€‚æŒç»­å€’æŒ‚æ˜¯è¡°é€€çš„æœ€å¯é å…ˆè¡ŒæŒ‡æ ‡ï¼ˆé¢†å…ˆ12-18ä¸ªæœˆï¼‰ã€‚",
    high: "æ›²çº¿é™¡å³­åŒ–ï¼šå¸‚åœºé¢„æœŸç»æµå‘å¥½ã€‚é“¶è¡Œç›ˆåˆ©æ”¹å–„ã€‚",
    low: "æ›²çº¿å¹³å¦/å€’æŒ‚ï¼šå¸‚åœºé¢„æœŸç»æµæ”¾ç¼“æˆ–è¡°é€€ã€‚",
    chart: "curve_slope_bps",
  },
  vix: {
    title: "VIX (ææ…ŒæŒ‡æ•°)",
    what: "æ ‡æ™®500æœŸæƒ30å¤©éšå«æ³¢åŠ¨ç‡ã€‚20-25è­¦æˆ’ï¼Œ25-30ç´§å¼ ï¼Œ30+ææ…Œã€‚æç«¯é«˜ä½ï¼ˆ>35ï¼‰åè€Œå¯èƒ½æ˜¯åº•éƒ¨ä¿¡å·ã€‚",
    high: "å¸‚åœºææ…ŒåŠ å‰§ï¼Œé€šå¸¸ä¼´éšè‚¡å¸‚æ€¥è·Œå’ŒæµåŠ¨æ€§æ”¶ç´§ã€‚",
    low: "å¸‚åœºæåº¦å¹³é™ã€‚æŒç»­ä½æ³¢å¯èƒ½å­•è‚²å°¾éƒ¨é£é™©ï¼ˆæ˜æ–¯åŸºæ—¶åˆ»ï¼‰ã€‚",
    chart: "vix",
  },
  spx: {
    title: "S&P 500 (æ ‡æ™®500)",
    what: "å…¨çƒé£é™©èµ„äº§çš„é”šã€‚åœ¨æµåŠ¨æ€§æ¡†æ¶ä¸­ä½œä¸º'ç¡®è®¤æŒ‡æ ‡'â€”â€”è§‚å¯Ÿæ˜¯å¦è·ŸéšæµåŠ¨æ€§ä¿¡å·ååº”ã€‚",
    high: "é£é™©åå¥½å¼ºåŠ²ã€‚å¦‚åŒæ—¶å‡€æµåŠ¨æ€§å……è£• = å¥åº·ç‰›å¸‚ã€‚",
    low: "é£é™©åå¥½æ¶åŒ–ã€‚å¦‚ä¸æµåŠ¨æ€§æ”¶ç´§åŒæ­¥ä¸‹è·Œ = ç¡®è®¤è¶‹ç´§ã€‚",
    chart: "spx",
  },
  dxy: {
    title: "ç¾å…ƒæŒ‡æ•° (DXY)",
    what: "ç¾å…ƒå¯¹ä¸€ç¯®å­ä¸»è¦è´§å¸çš„åŠ æƒæŒ‡æ•°ã€‚ç¾å…ƒèµ°å¼º = å…¨çƒç¾å…ƒæµåŠ¨æ€§æ”¶ç´§ï¼Œå¯¹éç¾èµ„äº§å’Œå¤§å®—å•†å“å½¢æˆå‹åŠ›ã€‚",
    high: "å…¨çƒç¾å…ƒæµåŠ¨æ€§ç´§ç¼©ï¼Œä¸åˆ©äºéç¾èµ„äº§ã€å¤§å®—ã€æ–°å…´å¸‚åœºã€‚",
    low: "ç¾å…ƒæµåŠ¨æ€§å¤–æº¢ï¼Œå…¨çƒRisk-Onã€‚æœ‰åˆ©äºBTCå’Œæ–°å…´å¸‚åœºã€‚",
    chart: "dxy",
  },
  btc: {
    title: "Bitcoin (BTC/USD)",
    what: "å‡€æµåŠ¨æ€§çš„æ æ†ç‰ˆæœ¬ã€‚BTCå¯¹å…¨çƒæµåŠ¨æ€§å˜åŒ–æåº¦æ•æ„Ÿï¼Œå¾€å¾€æ¯”ä¼ ç»Ÿé£é™©èµ„äº§æ›´æ—©ã€æ›´çŒ›çƒˆåœ°åæ˜ æµåŠ¨æ€§æ”¶ç¼©ã€‚",
    high: "æµåŠ¨æ€§æåº¦å……è£•ï¼ŒæŠ•æœºæƒ…ç»ªé«˜æ¶¨ã€‚",
    low: "æµåŠ¨æ€§æ”¶ç´§çš„'çŸ¿äº•é‡‘ä¸é›€'ã€‚å¤§å¹…ä¸‹è·Œä½†SPXæœªååº”æ—¶ï¼Œå¯èƒ½æ˜¯å‰ç»é¢„è­¦ã€‚",
    chart: "btc",
  },
};

const SECTION_ORDER = [
  "net_liquidity","composite","sofr","move_proxy","hy_oas",
  "usdjpy","carry_spread","curve_slope","vix","spx","dxy","btc",
];

const IND_NAME = {
  net_liquidity:"å‡€æµåŠ¨æ€§", vix:"VIXææ…ŒæŒ‡æ•°", hy_oas:"é«˜æ”¶ç›Šä¿¡ç”¨åˆ©å·®",
  sofr:"SOFRèµ„é‡‘åˆ©ç‡", dxy:"ç¾å…ƒæŒ‡æ•°", carry_spread_bps:"å¥—æ¯åˆ©å·®",
  curve_slope_bps:"æ”¶ç›Šç‡æ›²çº¿", on_rrp:"é€†å›è´­(RRP)",
};

const DATA_KEY_MAP = {
  net_liquidity:"net_liquidity", composite:"spx", sofr:"sofr", move_proxy:"move_proxy",
  hy_oas:"hy_oas", usdjpy:"usdjpy", carry_spread:"carry_spread_bps",
  curve_slope:"curve_slope_bps", vix:"vix", spx:"spx", dxy:"dxy", btc:"btc",
};

const METRIC_DEFS = [
  ["net_liquidity","å‡€æµåŠ¨æ€§","B",1],
  ["sofr","SOFR","%",4],
  ["hy_oas","HY OAS","%",2],
  ["move_proxy","MOVE Proxy","",1],
  ["vix","VIX","",1],
  ["usdjpy","USD/JPY","",1],
  ["carry_spread_bps","å¥—æ¯åˆ©å·®","bps",0],
  ["curve_slope_bps","æ›²çº¿æ–œç‡","bps",0],
  ["spx","S&P 500","",0],
  ["btc","Bitcoin","$",0],
  ["dxy","DXY","",1],
  ["us2y","US 2Y","%",3],
  ["us10y","US 10Y","%",3],
];

const BAD_WHEN_UP = new Set(["sofr","hy_oas","vix","move_proxy","dxy"]);
const PCT_IND = new Set(["spx","btc","usdjpy","dxy"]);

// ============================================================
// Components
// ============================================================

function SignalBadge({sig}) {
  const map = {
    STRESS:  {icon:"ğŸ”´", bg:"#451a1a", color:"#fca5a5"},
    TIGHT:   {icon:"ğŸŸ¡", bg:"#422006", color:"#fcd34d"},
    EASING:  {icon:"ğŸŸ¢", bg:"#052e16", color:"#86efac"},
    NEUTRAL: {icon:"âšª", bg:"#1e293b", color:"#94a3b8"},
  };
  const s = map[sig] || map.NEUTRAL;
  return <span className="signal-badge" style={{background:s.bg,color:s.color}}>{s.icon} {sig}</span>;
}

function ScoreHero({data}) {
  const {score, advice, asset_outlook} = data;
  return (
    <div className="score-hero">
      <div className="score-left">
        <div className="score-label">å®è§‚æµåŠ¨æ€§ç»¼åˆè¯„åˆ†</div>
        <div className="score-number" style={{color:score.tier_color}}>{score.composite}</div>
        <div className="score-tier" style={{
          background: score.tier_color + "18",
          color: score.tier_color,
          border: `2px solid ${score.tier_color}`
        }}>
          {score.tier_emoji} {score.tier_cn}
        </div>
        <GaugeSVG score={score.composite} color={score.tier_color} />
      </div>
      <div className="score-right">
        <div className="advice-position" style={{color:score.tier_color}}>{advice.position}</div>
        <div className="advice-detail">{advice.position_detail}</div>
        <div className="advice-action">{advice.btc_action}</div>
        <div className="advice-action">{advice.spx_action}</div>
        <div className="advice-action">{advice.nasdaq_action}</div>
        {advice.key_risk && <div className="advice-risk">{advice.key_risk}</div>}
        {advice.key_catalyst && <div className="advice-catalyst">{advice.key_catalyst}</div>}
      </div>
    </div>
  );
}

function GaugeSVG({score, color}) {
  const cx=120, cy=120, r=90;
  const angle = -135 + (score/100)*270;
  const rad = a => a * Math.PI / 180;
  const px = (a) => cx + r * Math.cos(rad(a));
  const py = (a) => cy + r * Math.sin(rad(a));
  const nl = 75;
  const nx = cx + nl * Math.cos(rad(angle));
  const ny = cy + nl * Math.sin(rad(angle));

  const arcs = [
    {s:-135, e:-90, c:"#991b1b"},
    {s:-90, e:-45, c:"#ef4444"},
    {s:-45, e:0, c:"#eab308"},
    {s:0, e:45, c:"#22c55e"},
    {s:45, e:135, c:"#16a34a"},
  ];

  return (
    <svg viewBox="0 0 240 160" style={{width:220,height:150,marginTop:8}}>
      {arcs.map((a,i) => (
        <path key={i}
          d={`M ${px(a.s)} ${py(a.s)} A ${r} ${r} 0 0 1 ${px(a.e)} ${py(a.e)}`}
          fill="none" stroke={a.c} strokeWidth="14" opacity="0.35"
          strokeLinecap={i===0?"round":i===4?"round":"butt"}
        />
      ))}
      <line x1={cx} y1={cy} x2={nx.toFixed(1)} y2={ny.toFixed(1)}
        stroke={color} strokeWidth="3" strokeLinecap="round"/>
      <circle cx={cx} cy={cy} r="5" fill={color}/>
      <text x="32" y="142" fontSize="9" fill="#64748b">0</text>
      <text x="112" y="22" fontSize="9" fill="#64748b" textAnchor="middle">50</text>
      <text x="202" y="142" fontSize="9" fill="#64748b">100</text>
    </svg>
  );
}

function AssetCards({outlook}) {
  const icons = {btc:"â‚¿", spx:"ğŸ“ˆ", nasdaq:"ğŸ’»"};
  const labels = {btc:"Bitcoin", spx:"S&P 500", nasdaq:"çº³æ–¯è¾¾å…‹"};
  return (
    <div className="asset-grid">
      {["btc","spx","nasdaq"].map(k => {
        const a = outlook[k];
        if (!a) return null;
        return (
          <div className="asset-card" key={k}>
            <div className="asset-icon">{icons[k]}</div>
            <div className="asset-info">
              <div className="asset-name">{labels[k]}</div>
              <div className="asset-score-num" style={{color:a.color}}>{Math.round(a.score)}</div>
              <div className="asset-tier-badge" style={{
                background:a.color+"20", color:a.color, border:`1px solid ${a.color}`
              }}>{a.tier_cn}</div>
              <div className="asset-note">{a.note}</div>
            </div>
          </div>
        );
      })}
    </div>
  );
}

function ScoreBreakdown({data}) {
  const {indicator_scores, weights, advice} = data;
  const sorted = Object.entries(indicator_scores).sort((a,b) => b[1].score - a[1].score);

  return (
    <div className="breakdown">
      <div className="breakdown-title">å„æŒ‡æ ‡è¯„åˆ†æ˜ç»†</div>
      <div className="breakdown-sub">è¯„åˆ†0-100ï¼Œè¶Šé«˜è¶Šåˆ©å¤šé£é™©èµ„äº§ | æƒé‡åŸºäºå®è§‚ç ”ç©¶+å›æµ‹ç›¸å…³æ€§</div>
      {sorted.map(([name, info]) => (
        <div className="bar-row" key={name}>
          <div className="bar-label">
            {IND_NAME[name]||name}
            <span className="bar-weight">({weights[name]||0}%)</span>
          </div>
          <div className="bar-track">
            <div className="bar-fill" style={{width:`${info.score}%`,background:info.signal_color}}/>
          </div>
          <div className="bar-val" style={{color:info.signal_color}}>{Math.round(info.score)}</div>
          <div className="bar-signal" style={{color:info.signal_color}}>{info.signal_cn}</div>
        </div>
      ))}
      <div className="factors">
        <div>
          <div className="factors-title" style={{color:"#22c55e"}}>åˆ©å¤šå› ç´ </div>
          {(advice.bullish_factors||[]).map(([n,s,sig],i) =>
            <div className="factor-item" style={{color:"#86efac"}} key={i}>
              âœ… {IND_NAME[n]||n}ï¼ˆ{Math.round(s)}åˆ† {sig}ï¼‰
            </div>
          )}
          {!(advice.bullish_factors||[]).length &&
            <div className="factor-item" style={{color:"#475569"}}>æš‚æ— æ˜æ˜¾åˆ©å¤š</div>}
        </div>
        <div>
          <div className="factors-title" style={{color:"#ef4444"}}>åˆ©ç©ºå› ç´ </div>
          {(advice.bearish_factors||[]).map(([n,s,sig],i) =>
            <div className="factor-item" style={{color:"#fca5a5"}} key={i}>
              âš ï¸ {IND_NAME[n]||n}ï¼ˆ{Math.round(s)}åˆ† {sig}ï¼‰
            </div>
          )}
          {!(advice.bearish_factors||[]).length &&
            <div className="factor-item" style={{color:"#475569"}}>æš‚æ— æ˜æ˜¾åˆ©ç©º</div>}
        </div>
      </div>
    </div>
  );
}

function JudgmentBox({judgment}) {
  const styles = {
    TIGHTENING:  {bg:"#451a1a",border:"#ef4444",icon:"ğŸ”´",color:"#fca5a5"},
    LOCAL_DISTURBANCE: {bg:"#422006",border:"#f59e0b",icon:"ğŸŸ¡",color:"#fcd34d"},
    STABLE:      {bg:"#052e16",border:"#10b981",icon:"ğŸŸ¢",color:"#86efac"},
    UNKNOWN:     {bg:"#1e293b",border:"#64748b",icon:"âšª",color:"#94a3b8"},
  };
  const s = styles[judgment.regime] || styles.UNKNOWN;

  return (
    <div className="judgment">
      <div className="judgment-regime" style={{background:s.bg,border:`1px solid ${s.border}`,color:s.color}}>
        {s.icon} {judgment.regime_cn || "?"}
      </div>
      <div className="judgment-text">{judgment.explanation}</div>
      <div className="judgment-tags">
        <span className="judgment-tag">å‡€æµåŠ¨æ€§èµ°å¼±: <b>{judgment.net_liquidity_weakening ? "æ˜¯" : "å¦"}</b></span>
        <span className="judgment-tag">ç¡®è®¤ç»´åº¦: <b>{judgment.stress_count||0}</b>ä¸ª</span>
        <span className="judgment-tag">é£é™©èµ„äº§ç¡®è®¤: <b>{judgment.risk_asset_confirming ? "æ˜¯" : "å¦"}</b></span>
      </div>
    </div>
  );
}

function SummaryTable({readings, changes}) {
  return (
    <div className="table-wrap">
      <table>
        <thead><tr>
          <th>æŒ‡æ ‡</th><th style={{textAlign:"right"}}>æœ€æ–°å€¼</th>
          <th style={{textAlign:"right"}}>5æ—¥å˜åŠ¨</th>
          <th style={{textAlign:"center"}}>Z-Score</th>
          <th style={{textAlign:"center"}}>åˆ†ä½</th>
          <th style={{textAlign:"center"}}>ä¿¡å·</th>
        </tr></thead>
        <tbody>
          {METRIC_DEFS.map(([key,label,unit,dec]) => {
            const r = readings[key] || {};
            const c = changes[key] || {};
            const val = r.value;
            const valStr = val != null ? Number(val).toLocaleString(undefined,{minimumFractionDigits:dec,maximumFractionDigits:dec})+unit : "N/A";
            const chg5 = PCT_IND.has(key) && c.pct_5d != null ? c.pct_5d : c.chg_5d;
            let chgStr = "N/A", chgColor = "#64748b";
            if (chg5 != null) {
              chgStr = PCT_IND.has(key) && c.pct_5d != null
                ? (c.pct_5d*100).toFixed(1)+"%" : Number(chg5).toFixed(2);
              if (chg5 > 0) chgStr = "+"+chgStr;
              chgColor = BAD_WHEN_UP.has(key)
                ? (chg5>0?"#fca5a5":chg5<0?"#86efac":"#64748b")
                : (chg5<0?"#fca5a5":chg5>0?"#86efac":"#64748b");
            }
            const zs = r.zscore;
            const zsStr = typeof zs === "number" ? (zs>=0?"+":"")+zs.toFixed(2) : "N/A";
            const pctl = r.percentile;
            const pctlStr = pctl != null ? Math.round(pctl*100)+"%" : "N/A";
            return (
              <tr key={key}>
                <td style={{fontWeight:600}}>{label}</td>
                <td className="num">{valStr}</td>
                <td className="num" style={{color:chgColor,fontWeight:600}}>{chgStr}</td>
                <td style={{textAlign:"center"}}>{zsStr}</td>
                <td style={{textAlign:"center"}}>{pctlStr}</td>
                <td style={{textAlign:"center"}}><SignalBadge sig={r.signal || "NEUTRAL"}/></td>
              </tr>
            );
          })}
        </tbody>
      </table>
    </div>
  );
}

function IndicatorSection({secKey, idx, readings, changes, charts}) {
  const kb = KNOWLEDGE[secKey];
  if (!kb) return null;
  const chartB64 = charts[kb.chart];
  if (!chartB64) return null;

  const dataKey = DATA_KEY_MAP[secKey] || secKey;
  const r = readings[dataKey] || {};
  const val = r.value;
  let valDisplay = "N/A";
  if (val != null) {
    if (["spx","btc"].includes(dataKey)) valDisplay = Math.round(val).toLocaleString();
    else if (["sofr","hy_oas"].includes(dataKey)) valDisplay = Number(val).toFixed(4)+"%";
    else if (dataKey==="net_liquidity") valDisplay = Number(val).toFixed(1)+"B";
    else if (["carry_spread_bps","curve_slope_bps"].includes(dataKey)) valDisplay = Math.round(val)+" bps";
    else valDisplay = Number(val).toFixed(2);
  }

  return (
    <div className="indicator" id={`sec-${secKey}`}>
      <div className="indicator-header">
        <div className="indicator-num">{idx}</div>
        <div>
          <div className="indicator-title">{kb.title}</div>
          <div className="indicator-val">
            å½“å‰: <b>{valDisplay}</b> <SignalBadge sig={r.signal || "NEUTRAL"}/>
          </div>
        </div>
      </div>
      <div className="indicator-chart">
        <img src={`data:image/png;base64,${chartB64}`} alt={kb.title}/>
      </div>
      <div className="explain-what">
        <div className="explain-label">è¿™æ˜¯ä»€ä¹ˆ</div>
        <div className="explain-text">{kb.what}</div>
      </div>
      <div className="explain-grid">
        <div className="explain-good">
          <div className="explain-label">â–² åé«˜æ„å‘³ç€</div>
          <div className="explain-text">{kb.high}</div>
        </div>
        <div className="explain-bad">
          <div className="explain-label">â–¼ åä½æ„å‘³ç€</div>
          <div className="explain-text">{kb.low}</div>
        </div>
      </div>
    </div>
  );
}

function QualityTable({quality}) {
  return (
    <div className="quality">
      <table>
        <thead><tr><th>æŒ‡æ ‡</th><th>çŠ¶æ€</th><th>è¦†ç›–ç‡</th><th>æ»å(å¤©)</th><th>æœ€åæœ‰æ•ˆæ—¥</th></tr></thead>
        <tbody>
          {Object.entries(quality).filter(([k,v]) => typeof v === "object").map(([k,v]) => (
            <tr key={k}>
              <td>{k}</td>
              <td><span style={{color:v.status==="ok"?"#86efac":"#fcd34d"}}>â—</span> {v.status}</td>
              <td>{Math.round((v.coverage||0)*100)}%</td>
              <td>{v.stale_days||0}</td>
              <td>{v.last_valid||"N/A"}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

// ============================================================
// Main App
// ============================================================
function App() {
  const [data, setData] = useState(null);
  const [error, setError] = useState(null);

  useEffect(() => {
    fetch("./data/latest.json")
      .then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.json();
      })
      .then(setData)
      .catch(e => setError(e.message));
  }, []);

  if (error) return (
    <div className="container">
      <div className="loading">
        <div style={{fontSize:48}}>âš ï¸</div>
        <div className="loading-text">æ•°æ®åŠ è½½å¤±è´¥: {error}</div>
        <div className="loading-text" style={{fontSize:12}}>è¯·ç¡®è®¤ data/latest.json å­˜åœ¨</div>
      </div>
    </div>
  );

  if (!data) return (
    <div className="container">
      <div className="loading">
        <div className="loading-spinner"/>
        <div className="loading-text">åŠ è½½æ•°æ®ä¸­...</div>
      </div>
    </div>
  );

  const meta = data.meta || {};
  const reportDate = meta.report_date || "";
  const genTime = (data.generated_at || "").slice(0,19);

  return (
    <div className="container">
      {/* Header */}
      <div className="header">
        <div>
          <h1>å®è§‚æµåŠ¨æ€§ä»ªè¡¨ç›˜</h1>
          <div className="header-meta">
            {reportDate}
            <span className="header-badge">æ›´æ–°äº {genTime}</span>
            <span className="header-badge">{meta.data_range?.trading_days || 0} äº¤æ˜“æ—¥</span>
          </div>
        </div>
      </div>

      {/* Score Hero */}
      <ScoreHero data={data} />

      {/* Asset Outlook */}
      <AssetCards outlook={data.asset_outlook || {}} />

      {/* Score Breakdown */}
      <ScoreBreakdown data={data} />

      <div className="note" style={{marginBottom:24}}>
        è¯„åˆ†æ–¹æ³•ï¼šæ¯ä¸ªæŒ‡æ ‡ç»¼åˆã€Œå½“å‰åˆ†ä½(40%)+è¿‘æœŸè¶‹åŠ¿(35%)+Z-Scoreåç¦»åº¦(25%)ã€è®¡ç®—0-100åˆ†ã€‚
        æƒé‡æ¥è‡ªå®è§‚é‡‘èç ”ç©¶(Howell 2020, Adrian & Shin 2010ç­‰)åŠå†å²ç›¸å…³æ€§åˆ†æã€‚
        BTCå¯¹æµåŠ¨æ€§betaçº¦1.5xï¼Œçº³æ–¯è¾¾å…‹çº¦1.05xï¼Œæ ‡æ™®500çº¦0.9xã€‚æœ¬è¯„åˆ†ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚
      </div>

      {/* Judgment */}
      <div className="section-divider">ç»¼åˆç ”åˆ¤</div>
      <JudgmentBox judgment={data.judgment || {}} />

      {/* Summary Table */}
      <div className="section-divider">æŒ‡æ ‡é€Ÿè§ˆ</div>
      <SummaryTable readings={data.readings || {}} changes={data.changes || {}} />

      {/* Nav */}
      <div className="section-divider">é€é¡¹åˆ†æ</div>
      <div className="nav-bar">
        {SECTION_ORDER.map(k => {
          const kb = KNOWLEDGE[k];
          return kb ? (
            <a className="nav-link" key={k}
               onClick={() => document.getElementById(`sec-${k}`)?.scrollIntoView({behavior:"smooth"})}>
              {kb.title.split("(")[0].trim().split(" ")[0]}
            </a>
          ) : null;
        })}
      </div>

      {/* Indicator Sections */}
      {SECTION_ORDER.map((k, i) => (
        <IndicatorSection
          key={k} secKey={k} idx={i+1}
          readings={data.readings || {}}
          changes={data.changes || {}}
          charts={data.charts || {}}
        />
      ))}

      {/* Data Quality */}
      <div className="section-divider">æ•°æ®æºçŠ¶æ€</div>
      <QualityTable quality={data.quality || {}} />

      {/* Footer */}
      <div className="footer">
        å®è§‚æµåŠ¨æ€§ä»ªè¡¨ç›˜ | æ•°æ®æº: FRED API + Yahoo Finance | æ¯æ—¥ 08:00 UTC+8 è‡ªåŠ¨æ›´æ–°<br/>
        æœ¬æŠ¥å‘Šä»…ä¾›ç ”ç©¶å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚å¸‚åœºæœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…ã€‚
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
